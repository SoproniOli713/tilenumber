"use strict";function Tile(){this.container=$(".tile-container"),this.tile_container=$(".tile-game-container"),this.disp_score=$(".disp-score"),this.disp_tile=$(".disp-tile"),this.disp_life=$(".disp-life"),this.count_find=this.matrix=this.ctrCount=4,this.ctrCorrect=0,this.myarr=null,this.numToFind=null,this.score=0,this.life=0,this.disp_num_find=null,this.roundConsecutive=0,this.can_open=!1,this.hideTime=0,this.cgame=!0,this.init_check()}Tile.prototype={init_check:function(){var t=window.localStorage;if(t.length>0){var i=JSON.parse(t.getItem("game"));this.count_find=i.count_find,this.life=i.life,this.score=i.score,this.matrix=i.matrix,this.cgame=i.game_complete,this.update_score_display(0),this.update_life_display(0)}this.start()},start:function(){var t=this;this.can_open=!1,this.numToFind=0,this.next_level_pop_up(1==this.cgame?"start":"resume"),this.update_hide_time(!1),setTimeout(function(){t.get_find_number(),t.show_find_number(t.numToFind),t.create_matrix()},1e3)},ready:function(t){var i=this,e=3e3,n=1e3;(0==t||"start"==t)&&i.reset_all(),this.can_open=!1,this.update_tile_display(this.count_find),this.slide_down_tile(),64==this.count_find&&(e=n=500),setTimeout(function(){i.hide_find_number(),setTimeout(function(){i.show_tile(),i.bind()},n)},e)},slide_down_tile:function(){var t=this,i=Math.pow(this.matrix,2),e=this.container.find(".tile");this.create_number_array(i),64==this.count_find&&(this.win={10:"W",11:"E",12:"L",13:"L",18:"D",19:"O",20:"N",21:"E",33:"Y",34:"O",35:"U",36:"W",37:"I",38:"N"}),e.each(function(i,e){var n=$(e).children(),a=n[0],s=n[1];$(e).removeClass("b-red tile-active"),$(s).removeAttr("class"),$(s).addClass("shield"),64==t.count_find?($(e).addClass("b-red"),$(a).html("â˜†"),$(s).attr("style","background:#3399FF"),void 0!=t.win[i.toString()]&&($(a).html(t.win[i.toString()]),$(s).html(t.win[i.toString()]))):$(a).html(t.myarr[i])})},empty_container:function(){this.tile_container.empty()},get_find_number:function(){this.numToFind=this.getRandomInt(1,10)},show_find_number:function(t){var i=this.container.find(".num-find-container");if(0==i.length){var e=$("<div/>"),n=$("<div/>"),a=$("<p/>"),s=$("<p/>"),o=$("<p/>");n.attr("class","num-find"),e.attr("class","num-find-container"),s.attr("class","p-divider"),n.append(a.html("Number to Find")),n.append(s),n.append(o),e.append(n),this.container.append(e),this.disp_num_find=o,e=null,n=null,a=null,s=null,o=null}else this.disp_num_find.html(t),i.addClass("t0"),this.tile_container.removeClass("t0")},hide_find_number:function(){this.container.find(".num-find-container").removeClass("t0"),this.tile_container.addClass("t0")},create_matrix:function(){var t=Math.pow(this.matrix,2);this.create_number_array(t);var i=this.matrix.toString(),e=0,n=$("<div/>"),a=$("<div/>"),s=$("<div/>"),o=$("<div/>"),r="dim-"+i+"x"+i;for(a.attr("class","tile "+r),o.attr("class","shield"),s.attr("class","numbers"),a.append(s),a.append(o),e;t>e;e++){var l=a.clone();l.find("div").first().html(this.myarr[e]),n.append(l)}this.tile_container.append(n.html())},show_tile:function(){var t=this;64==t.count_find&&(t.hideTime=3e3),setTimeout(function(){t.container.find(".shield").removeClass("shield").addClass("anim"),t.remove_numbers()},t.hideTime)},remove_numbers:function(){var t=this;t.can_open=!1,setTimeout(function(){t.container.find(".numbers").empty(),setTimeout(function(){t.can_open=!0},300)},1e3)},bind:function(){var t=this;this.container.off(),this.container.find(".anim").unbind("click"),t.count_find<64&&this.container.on("click",".anim",function(i){i.preventDefault(),i.stopPropagation(),t.ctrCount>0&&1==t.can_open&&(t.ctrCount--,t.update_tile_display(t.ctrCount),t.animate_tile_open(i))})},update_tile_display:function(t){this.disp_tile.html(t)},update_score_display:function(t){this.score+=t,this.disp_score.html(this.score)},update_life_display:function(t){this.life+=t,this.disp_life.html(this.life)},update_all_display:function(t,i,e){this.update_score_display(t),this.update_tile_display(i),this.update_life_display(e)},animate_tile_open:function(t){var i=$(t.target),e=i.parent(),n=e.index(),a=this.myarr[n],s="anim"+this.matrix.toString()+"x"+this.matrix.toString();this.check_open_tile(a,e),e.find(".numbers").html(a),i.removeClass("anim").addClass(s),0==this.ctrCount&&this.finish_open_all_tiles()},check_open_tile:function(t,i){t==this.numToFind?(this.ctrCorrect++,this.update_score_display(100),i.addClass("tile-active")):i.addClass("b-red")},finish_open_all_tiles:function(){var t=this,i=this.container.find(".tile"),e=this.container.find(".anim"),n="anim"+this.matrix.toString()+"x"+this.matrix.toString();i.each(function(i,e){$(e).find(".numbers").html(t.myarr[i])}),setTimeout(function(){e.removeClass("anim").addClass(n),setTimeout(function(){t.next_level()},1e3)},1e3)},next_level:function(){var t=this,i=window;if(t.count_find==t.ctrCorrect?(t.count_find=t.ctrCount=t.count_find+1,t.roundConsecutive++,t.update_hide_time(!0),t.roundConsecutive>2&&(this.update_life_display(1),t.roundConsecutive=0)):(t.count_find>t.matrix?t.count_find=t.ctrCount=t.count_find-1:t.ctrCount=t.count_find,t.update_hide_time(!1),this.update_life_display(-1),t.roundConsecutive=0),0==t.life)return void i.setTimeout(function(){t.animate_finish(4),t.next_level_pop_up(!1)},1e3);if(64==t.count_find)return t.update_score_display(100*t.count_find),t.game_complete(),t.show_finish(),void i.setTimeout(function(){t.ready()},2e3);t.ctrCorrect=0;var e=Math.pow(t.matrix,2);if(t.count_find>e){var n=t.matrix+1;t.matrix++,t.tile_container.fadeOut("fast"),t.empty_container(),t.create_matrix(),t.tile_container.fadeIn("fast"),t.animate_finish(n),t.next_level_pop_up()}else t.get_find_number(),t.show_find_number(t.numToFind),window.setTimeout(function(){t.ready()},2e3)},next_level_pop_up:function(t){var i=$(".level-up-pop-container");if(0==i.length){var e=$("<div/>"),n=$("<div/>"),a=$("<p/>"),s=$("<p/>"),o=$("<div/>");e.addClass("level-up-pop-container level-up-pop-top"),n.addClass("level-up-pop"),a.addClass("b-red"),a.html("LEVEL UP"),s.addClass("p-divider"),o.addClass("level-go"),o.html("GO"),0==t?(a.html("GAME COMPLETE"),o.html("TRY AGAIN")):"start"==t?(a.html("WELCOME"),o.html("START")):"resume"==t&&(a.html("WELCOME"),o.html("RESUME")),n.append(a),n.append(s),n.append(o),e.append(n),this.container.append(e)}else{var n=i.find(".level-up-pop"),o=n.find("div").last(),a=n.find("p").first();0==t&&(a.html("GAME COMPLETE"),o.html("TRY AGAIN"),i.removeClass("level-up-exit").addClass("level-up-pop-top"))}var r=this;window.setTimeout(function(){r.container.find(".level-up-pop-container").removeClass("level-up-pop-top").addClass("level-up-anim")},1e3),this.container.off().on("click",".level-go",function(){r.get_find_number(),r.show_find_number(r.numToFind),r.count_find=r.ctrCount=r.matrix,r.update_hide_time(!1),r.container.find(".level-up-pop-container").removeClass("level-up-anim").addClass("level-up-exit"),r.tile_container.addClass("level-up-exit"),r.container.find(".num-find-container").addClass("anim-global t0"),window.setTimeout(function(){r.ready(t)},1e3)}),e=null,n=null,a=null,s=null,o=null},animate_finish:function(t){var i="anim"+this.matrix.toString()+"x"+this.matrix.toString();this.matrix=t;var e=this.container.find("."+i);e.removeClass(i).addClass("anim-next b-green")},create_number_array:function(t){var i=new Array,e=t-this.count_find,n=null,a=0;for(a;a<this.count_find;a++)i.push(this.numToFind);for(;e>0;){var s=this.getRandomInt(1,10);s!==this.numToFind&&(i.push(s),e--)}n=this.shuffleArray(i),this.myarr=null,this.myarr=n},getRandomInt:function(t,i){return Math.floor(Math.random()*(i-t))+t},shuffleArray:function(t){for(var i=t.length-1;i>0;i--){var e=Math.floor(Math.random()*(i+1)),n=t[i];t[i]=t[e],t[e]=n}return t},reset_all:function(){this.count_find=this.matrix=this.ctrCount=4,this.ctrCorrect=0,this.matrix=4,this.myarr=null,this.score=0,this.life=3,this.roundConsecutive=0,this.update_all_display(this.score,this.count_find,0)},update_hide_time:function(t){var i=Math.pow(this.matrix,2);i-=4;var e=1e3*this.matrix/i;1==t?(this.hideTime-=e,this.hideTime<1e3&&(this.hideTime=1e3)):this.count_find==this.matrix?this.hideTime=1e3*this.matrix:this.hideTime+=e},game_complete:function(){var t=$("<div/>"),i=$(".num-find-container");t.html("G R E A T J O B"),t.addClass("great-job"),i.empty().append(t)},show_finish:function(){var t=this.container.find(".num-find-container");t.addClass("t0"),this.tile_container.removeClass("t0")}};var tile=new Tile;window.onbeforeunload=function(){var t=window;if(0==tile.life)t.localStorage.clear();else{tile.score-=100*tile.ctrCorrect;var i={matrix:tile.matrix,count_find:tile.count_find,score:tile.score,life:tile.life,game_complete:0==tile.life?!0:!1};t.localStorage.setItem("game",JSON.stringify(i))}};